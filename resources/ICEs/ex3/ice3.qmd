---
title: "ICE 3"
author: "William"
date: "September 2, 2024"
date-modified: "last-modified"
execute: 
  eval: true
  echo: true
  freeze: true
---

```{r}
pacman::p_load(sf, raster, spatstat, tmap, tidyverse)
```

# Issue 1: Installing maptools

Install from Posit Public Package Manager snapshots, because maptools is **retired** and binary is removed from CRAN

```{r eval=FALSE}
install.packages('maptools', repos = 'https://packagemanager.posit.co/cran/2023-10-13')
```

> When retrieving archived versions, take note of **dependencies**.

> After installing, ensure `eval=FALSE` the installing code to avoid maptools from being downloaded and installed **repetitively** every time the `qmd` is rendered.

# Issue 2: Create coastal outline

In sf package, there are 2 functions that allow the combining of multiple sf into one sf:

-   st_combine() and

-   st_union()

``` r
# derive coastal outline of tibble data.frame
sg_sf <- mpsz_sf %>% st_union()
```

```{r}
sg_sf <- mpsz_sf %>% st_union()
plot(sg_sf)

# doesnt work cuz idk, will troubleshoot later
```

> Note: straight convert to sf for consistency
>
> [Reference for enrichment](https://r-spatial.github.io/sf/reference/st_as_sf.html?q=ppp#ref-usage)

# KDE - converting output into grid object

[Reference](https://piazza.com/class/lz7t191n3cp723/post/14_f2)

-   maptools method: **as.SpatialGridDataFrame.im(x)**

In hands-on exercise 3, there will be an error if the above syntax is used, but can be resolved if maptools package is loaded in initially or if the following method is used.

-   spatstat.geom method: **as(x, 'SpatialGridDataFrame')**

# Take-Home Exercise 1: Geospatial Analysis for Social Good: Myanmar Armmed Conflict Case Study

-   [**Data**](https://acleddata.com/data/)(if have access key, for now we use eLearn file of **Myanmar**)

```{r}
acled_Myanmar_sf <- read_csv("data/ACLED_Myanmar.csv") %>% 
  st_as_sf(coords = c('longitude','latitude'),
    crs = 4326) %>%                           # important to know which PCS to use
  st_transform(crs = 32647) %>%               # source data
  mutate(event_date = dmy(event_date))

# note that myanmar cuts thru 2 different UTMs(a PCS)
# dmy: As long as the order of formats is correct, these functions will parse dates correctly even when the input vectors contain differently formatted dates.
```

```{r}
tmap_mode('view')
acled_Myanmar_sf %>% 
  filter(year==2023 | event_type=='Political violence') %>% 
  tm_shape()+
  tm_dots()
```

```{r}
tmap_mode('plot')
```
