---
title: "ICE 4: Spatio-Temporal Point Patterns Analysis"
author: "William"
date: "September 8, 2024"
date-modified: "last-modified"
execute: 
  eval: true
  echo: true
  freeze: true
---

Background

-   Spatio-temporal point process (**stpp**) is a random collection of points, where each point represents the time and location of an event

-   for geographically and temporally indexed data

-   Context:

    -   A real world forest fire events in Kepulauan Bangka Belitung, Indonesia from 1st January 2023 to 31st December 2023

# Objectives

-   are the locations of forest fire in Kepulauan Bangka Belitung spatial and spatio-temporally independent?

-   if the answer is NO, where and when the observed forest fire locations tend to cluster?

# Notes:

-   space-time KDE (**STKDE**) - bullet point 4-5 of THE1 where data is **across-time**, rather than the use of cross-sectional data in KDE (single-point in time) previously

# Code:

### **Load packages**

```{r}
pacman::p_load(sf, raster, spatstat, sparr, tmap, tidyverse)
```

### **Import and Prepare Study Area**

#### Import and remove 'z' 

```{r eval=FALSE}
kbb <- st_read(dsn = 'data/rawdata/', layer = 'Kepulauan_Bangka_Belitung') %>% 
  st_transform(crs = 32748)
```

> -   "desolve" 'z' boundaries before preparing study area
>
> -   kbb contains a new geometry type: polygonz, denoting as height — **drop 'z'** otherwise will incur an error when converting to ppp object class

Revised code chunk to account for the above

```{r}
kbb_sf <- st_read(dsn = 'data/rawdata/', layer = 'Kepulauan_Bangka_Belitung') %>% 
  # addition
  st_union() %>% 
  st_zm(drop = TRUE, what = 'ZM') %>% 
  # --------
  st_transform(crs = 32748)
```

#### **Convert to OWIN**

```{r}
kbb_owin <- as.owin(kbb_sf)
kbb_owin
```

#### Confirm class of output

```{r}
class(kbb_owin)
```

If using kbb with 'z', the following **error** will occur:

```{r}
# kbb_owin_error <- as.owin(kbb)

# error:
# Error in owinInternalPoly(xrange, yrange, ..., poly = poly, unitname = unitname) : 
#   poly must be either a list(x,y) or a list of list(x,y)
```

### **Import and Prepare Forest Data**

```{r}
fire_sf <- read_csv('data/rawdata/forestfires.csv') %>% 
  st_as_sf(coords = c('longitude', 'latitude'), crs = 4326) %>% # combines columns to convert into geospatial data
  st_transform(crs = 32748)
```

Because ppp object only accepts numerical or characters as mark, the code chunk below is used

# [**Readings**](~/is415-gaa-williamtjw/resources/ICEs/ex4)

Jonatan A. González, et. al. (2016) [“Spatio-temporal point process statistics: A review”](https://www.sciencedirect.com/science/article/pii/S2211675316301130?ref=pdf_download&fr=RR-2&rr=8bfff858af196002), *Spatial Statistics*, Volume 18, Part B, November 2016, Pages 505-544.

Alexander Hohl et. al.[“Spatiotemporal Point Pattern Analysis Using Ripley’s K”](https://pages.charlotte.edu/eric-delmelle/wp-content/uploads/sites/150/2019/09/Spatiotemporal-Point-Pattern-Analysis-Using-Ripleys-K-Function.pdf) in **Geospatial Data Science Techniques and Applications**.

Tonini, Marj et. al. (2017[) “Evolution of forest fires in Portugal: from spatio-temporal point events to smoothed density maps”](https://link-springer-com.libproxy.smu.edu.sg/article/10.1007/s11069-016-2637-x), *Natural hazards* (Dordrecht), 2017-02, Vol.85 (3), p.1489-1510. Available at SMU eJournal.

Juan, P et. al. (2012)[“Pinpointing spatio-temporal interactions in wildfire patterns”](https://link-springer-com.libproxy.smu.edu.sg/article/10.1007/s00477-012-0568-y), *Stochastic environmental research and risk assessment*, 2012-12, Vol.26 (8), p.1131-1150. Available at SMU eJournal.

# **About R**
